# 网络访问控制
## 网络策略应用场景
- 默认情况下，Kubernetes 集群网络没任何网络限制，Pod 可以与任何其他 Pod 通信，在某些场景下就需要进行网络控制，减少网络攻击面，提高安全性，这就会用到网络策略。
- Network Policy 是一个K8s资源，用于限制Pod出入流量，提供Pod级别和Namespace级别网络访问控制。
- 网络策略是由网络组件去实现的，比如 calico
## 网络策略概述
- 网络策略工作流程
    1. 创建Network Policy资源
    2. Policy Controller监控网络策略，同步并通知节点上程序
    3. 节点上DaemonSet运行的程序从etcd中获取Policy，调用本地Iptables创建防火墙规则
## 网络访问控制 5 个案例
1. 拒绝命名空间下所有 Pod 出入站流量
```
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: test-network-policy
  namespace: test1
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
```
2. 拒绝其他命名空间 Pod 访问
```
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: test-network-policy
  namespace: test1
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector: {}
```
3. 允许其他命名空间 Pod 访问指定应用
```
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: test-network-policy
  namespace: test1
spec:
  podSelector:
    matchLabels:
      run: web
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector: {}
```
4. 同一个命名空间下应用之间限制访问
```
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: test-network-policy
  namespace: test1
spec:
  podSelector:
    matchLabels:
      run: web
  policyTypes:
  - Ingress
  ingress:
  - from:
    - podSelector:
      matchLabels:
        run: client1
    ports:
    - protocol: TCP
      port: 80
```
5. 只允许指定命名空间中的应用访问
```

```